<!DOCTYPE html>
<html>
<head>
    <title>Shpanlist</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="include/jquery.mobile-1.3.1/jquery.mobile-1.3.1.min.css" />
    <script src="include/jquery-1.9.1.min.js"></script>
    <script src="include/jquery.mobile-1.3.1/jquery.mobile-1.3.1.min.js"></script>
    <script src="ShpanlistController.js"></script>
    <script type="text/javascript">
        var listGroupId = localStorage['currListGroupId'];

        function loadListGroup(){

            ShpanlistController.getListGroup(listGroupId, show);
        }

        function show (listGroupXml){
            var listGroupName = $(listGroupXml).find("name").first().text();
            var theHtml = '<h1>' + listGroupName + '</h1><br/><br/>';


            theHtml += '<h2>Active Lists</h2> <table id="tabListInstances">';
            $(listGroupXml).find("listInstanceRelationshipEntries").first().find("listInstance").each(function () {
                var currEntity = jQuery(this);
                var currEntityId = currEntity.attr("id");
                theHtml += '<tr><td>' + currEntity.find("name").first().text() + '</td>';
                theHtml += '<td><a href="javascript:ShpanlistController.menuListInstance(\'' + currEntityId + '\')\">Show List</a>' +
                        '&nbsp;<a href="javascript:ListGroupView.removeListInstance(\'' + currEntityId + '\')\">Remove</a>' +
                        '</td></tr>';
            });
            theHtml += '</table><br/><br/>';


            theHtml += '<h2>List Templates</h2> <table id="tabListInstances">';
            theHtml += '<table id="tabListTemplates">';
            $(listGroupXml).find("listTemplateRelationshipEntries").first().find("listTemplate").each(function () {
                var currEntity = $(this);
                var currEntityId = currEntity.attr("id");
                theHtml += '<tr><td>' + currEntity.find("name").first().text() + '</td>';
                theHtml += '<td><a HREF=\"javascript:ShpanlistController.menuListTemplate(\'' + currEntityId + '\')\">Open Template</a></td></tr>';
            });
            theHtml += '</table>';

            // Build group members table
            theHtml += '<h2>List Group members</h2><table id="tabGroupMembers">';
            $(listGroupXml).find("memberRelationshipEntries").first().find("listUser").each(function () {
                var currEntity = $(this);
                var currEntityId = currEntity.attr("id");
                theHtml += '<tr><td>' + currEntity.find("firstName").first().text() + ' ' + currEntity.find("lastName").first().text() +'</td>';
                theHtml += '<td><a HREF=\"javascript:ShpanlistController.removeGroupMember(\'' + currEntityId + '\')\">Remove</a></td></tr>';
            });

            theHtml += '</table><br/>';
            theHtml += 'UserName:<input type="text" id="txtNewMemberUserName"/><a HREF="javascript:ListGroupView.addNewMember()">Add Member</a><br/>';

            document.getElementById('pageListGroupContentDiv').innerHTML = theHtml;
        }

        function createNewItem(){
            ShpanlistController.addNewListTemplateItem(ListTemplateView.listTemplateId, txtNewItemName.value, txtNewItemDescription.value, txtNewItemDefaultAmount.value)
        }

        function removeItem(listTemplateItemId){
            ShpanlistController.removeListTemplateItem(ListTemplateView.listTemplateId, listTemplateItemId);
        }

        function createListFromTemplate(){
            ShpanlistController.createListFromTemplate(ListTemplateView.listTemplateId);
        }

        function addNewMember(){
            var memberUserName = txtNewMemberUserName.value;
            if (memberUserName == ""){
                alert("Please Type user name to add");
            }else{
                ShpanlistController.addNewGroupMember(ListGroupView.listGroupId, memberUserName);
            }
        }

        function removeListInstance(listInstanceId){
            var conf = confirm("Are you sure you want to remove this list?");
            if (conf){
                ShpanlistController.removeListInstance(listInstanceId, function(){
                    ShpanlistController.menuListGroup(ListGroupView.listGroupId);
                });
            }
        }



    </script>
</head>
<body onload="loadListGroup()">
<div data-role="page">
    <div data-role="header">
        Group
    </div>
    <div data-role="content" id="contentDiv">
        <ul id="lstGroups" data-role="listview"></ul>
    </div>
</div>
</body>
</html>
